{% extends "base.html" %}
{% block content %}

<style>

body{
    background: radial-gradient(circle at top,#1e293b,#0f172a);
    font-family:'Segoe UI',sans-serif;
    color:white;
}

.page{
    padding:30px;
}

/* ===== TITLE ===== */
h1{
    font-size:30px;
    font-weight:700;
    margin-bottom:25px;
    color:#ffffff;
}

/* ===== CARDS GRID ===== */
.cards{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
    gap:22px;
    margin-bottom:35px;
}

/* ===== CARD ===== */
.card{
    background:#374151;
    border-radius:22px;
    padding:26px;
    transition:all .35s ease;
    cursor:pointer;
    border:1px solid rgba(255,255,255,.08);
}


.card:hover{
    transform:translateY(-6px);
    background:#3f4b5f;  /* slightly brighter */
    border:1px solid #8b5cf6;
    box-shadow:0 0 25px rgba(139,92,246,.4);
}


.card.active{
    border:1px solid #8b5cf6;
}

.card h3{
    font-size:14px;
    color:#cbd5e1;
    margin-bottom:10px;
}

.count{
    font-size:40px;
    font-weight:800;
    color:#ffffff;
}

/* ===== SORT DROPDOWN ===== */
.controls{
    display:flex;
    justify-content:flex-end;
    margin-bottom:20px;
}

select{
    padding:10px 14px;
    border-radius:10px;
    border:none;
    background:#1e293b;
    color:white;
    font-size:14px;
    outline:none;
}

/* ===== TABLE ===== */
table{
    width:100%;
    border-collapse:collapse;
    background:#1e293b;
    border-radius:22px;
    overflow:hidden;
}

thead{
    background:#111827;
    color:white;
}

th{
    text-align:left;
    padding:18px;
    font-weight:600;
}

td{
    padding:18px;
    color:#e2e8f0;
}

tbody tr{
    border-bottom:1px solid rgba(255,255,255,.05);
    transition:.2s ease;
}

tbody tr:hover{
    background:#334155;
}

.empty{
    text-align:center;
    padding:25px;
    color:#94a3b8;
}

</style>

<div class="page">
<h1>Volunteers</h1>

<!-- ===== YEAR CARDS ===== -->
<div class="cards">
    <div class="card year-1 year-card" data-year="1st Year">üéì 1st Year<div class="count">{{ year_counts.1 }}</div></div>
    <div class="card year-2 year-card" data-year="2nd Year">üìò 2nd Year<div class="count">{{ year_counts.2 }}</div></div>
    <div class="card year-3 year-card" data-year="3rd Year">üìó 3rd Year<div class="count">{{ year_counts.3 }}</div></div>
    <div class="card year-4 year-card" data-year="4th Year">üèÅ Final Year<div class="count">{{ year_counts.4 }}</div></div>
</div>

<!-- ===== BRANCH CARDS ===== -->
<div class="cards">
    <div class="card branch-card branch-cse" data-branch="CSE">üíª CSE<div class="count">{{ branch_counts.CSE }}</div></div>
    <div class="card branch-card branch-ece" data-branch="ECE">üì° ECE<div class="count">{{ branch_counts.ECE }}</div></div>
    <div class="card branch-card branch-eee" data-branch="EEE">‚ö° EEE<div class="count">{{ branch_counts.EEE }}</div></div>
    <div class="card branch-card branch-mech" data-branch="MECH">üîß MECH<div class="count">{{ branch_counts.MECH }}</div></div>
    <div class="card branch-card branch-civil" data-branch="CIVIL">üèóÔ∏è CIVIL<div class="count">{{ branch_counts.CIVIL }}</div></div>
</div>

<!-- ===== SORT ===== -->
<div class="controls">
<select id="sortSelect">
    <option value="roll">Sort by Roll Number</option>
    <option value="name">Sort by Name</option>
</select>
</div>

<!-- ===== TABLE ===== -->
<table id="volunteerTable">
<thead>
<tr>
<th>Roll No</th>
<th>Name</th>
<th>Email</th>
<th>Year</th>
<th>Branch</th>
</tr>
</thead>
<tbody>
{% for v in volunteers %}
<tr data-year="{{ v.year }}" data-branch="{{ v.department }}">
<td>{{ v.student_id }}</td>
<td>{{ v.full_name }}</td>
<td>{{ v.user.email }}</td>
<td>{% if v.year == "4th Year" %}Final Year{% else %}{{ v.year }}{% endif %}</td>
<td>{{ v.department }}</td>
</tr>
{% empty %}
<tr id="emptyRow"><td colspan="5" class="empty">No volunteers found</td></tr>
{% endfor %}
</tbody>
</table>

</div>

<script>
let selectedYear = null;
let selectedBranch = null;

const yearCards = document.querySelectorAll(".year-card");
const branchCards = document.querySelectorAll(".branch-card");
const rows = document.querySelectorAll("#volunteerTable tbody tr");

/* ---------- FILTER FUNCTION ---------- */
function filterTable() {
    let visibleCount = 0;

    rows.forEach(row => {
        const rowYear = row.dataset.year;
        const rowBranch = row.dataset.branch;

        let show = true;

        if (selectedYear && rowYear !== selectedYear) show = false;
        if (selectedBranch && rowBranch !== selectedBranch) show = false;

        row.style.display = show ? "" : "none";
        if (show) visibleCount++;
    });

    toggleEmptyMessage(visibleCount);
}

/* ---------- EMPTY MESSAGE ---------- */
function toggleEmptyMessage(count) {
    let emptyRow = document.getElementById("noDataRow");

    if (!emptyRow) {
        emptyRow = document.createElement("tr");
        emptyRow.id = "noDataRow";
        emptyRow.innerHTML = `
            <td colspan="5" style="text-align:center;color:#6b7280;">
                No volunteers found
            </td>`;
        document.querySelector("#volunteerTable tbody").appendChild(emptyRow);
    }

    emptyRow.style.display = count === 0 ? "" : "none";
}

/* ---------- YEAR CLICK ---------- */
yearCards.forEach(card => {
    card.addEventListener("click", () => {
        yearCards.forEach(c => c.classList.remove("active"));
        branchCards.forEach(c => c.classList.remove("active"));

        card.classList.add("active");
        selectedYear = card.dataset.year;
        selectedBranch = null;

        filterTable();
    });
});

/* ---------- BRANCH CLICK ---------- */
branchCards.forEach(card => {
    card.addEventListener("click", () => {
        if (!selectedYear) {
            alert("Please select a year first");
            return;
        }

        branchCards.forEach(c => c.classList.remove("active"));
        card.classList.add("active");

        selectedBranch = card.dataset.branch;
        filterTable();
    });
});

/* ---------- SORT ---------- */
document.getElementById("sortSelect").addEventListener("change", function () {
    const tbody = document.querySelector("#volunteerTable tbody");
    const rowsArray = Array.from(rows);

    rowsArray.sort((a, b) => {
        if (this.value === "name") {
            return a.children[1].innerText.localeCompare(b.children[1].innerText);
        } else {
            return a.children[0].innerText.localeCompare(b.children[0].innerText);
        }
    });

    rowsArray.forEach(r => tbody.appendChild(r));
});

/* ---------- RESET ON PAGE LOAD ---------- */
filterTable();
</script>


{% endblock %}
