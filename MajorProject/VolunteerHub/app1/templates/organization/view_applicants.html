{% extends "organization/base.html" %}
{% block content %}

<style>
    body{ background:#f4f6fb; }

    .filter-bar{
        margin:20px 0;
    }

    .filter-btn{
        padding:10px 18px;
        border:none;
        border-radius:18px;
        margin-right:10px;
        cursor:pointer;
        font-weight:600;
    }

    table{
        width:100%;
        border-collapse:collapse;
        background:white;
        border-radius:12px;
        overflow:hidden;
    }

    th, td{
        padding:12px;
        border-bottom:1px solid #eee;
        text-align:left;
    }

    th{
        background:#111827;
        color:white;
    }

    .hidden{
        display:none;
    }

    .submit-row{
        margin-top:15px;
    }
</style>

<h1>Applicants â€” {{ service.title }}</h1>

<!-- ================= FILTER BUTTONS ================= -->

<div class="filter-bar">
    <button class="filter-btn" onclick="showTable('selected')">Selected</button>
    <button class="filter-btn" onclick="showTable('applied')">Applied</button>
    <button class="filter-btn" onclick="showTable('rejected')">Rejected</button>
</div>

<!-- ================= SELECTED TABLE ================= -->

<div id="selected_table">

    <h2>Selected Volunteers</h2>

    {% if selected_apps %}

    <form method="post" action="{% url 'mark_bulk_attendance' service.id %}">
        {% csrf_token %}

        <table>
            <tr>
                <th>Name</th>
                <th>Year</th>
                <th>Department</th>
                <th>Attendance</th>
            </tr>

            {% for app in selected_apps %}
            <tr>
                <td>{{ app.volunteer.full_name }}</td>
                <td>{{ app.volunteer.year }}</td>
                <td>{{ app.volunteer.department }}</td>

                <td>

                    {% if event_active %}

                    {% if app.id in marked_ids_today %}

                    {% if app.id in present_ids_today %}
                    <span style="color:green;font-weight:600;">
                Present
            </span>
                    {% else %}
                    <span style="color:red;font-weight:600;">
                Absent
            </span>
                    {% endif %}

                    {% else %}
                    <input type="checkbox" name="present_ids" value="{{ app.id }}">
                    {% endif %}

                    {% else %}
                    Event not active
                    {% endif %}

                </td>

            </tr>
            {% endfor %}
        </table>

        {% if event_active and unmarked_exists %}
        <div class="submit-row">
            <button type="submit">Submit Attendance</button>
        </div>
        {% endif %}

    </form>

    {% else %}
    <p>No selected volunteers</p>
    {% endif %}
</div>

<!-- ================= APPLIED TABLE ================= -->

<div id="applied_table" class="hidden">

    <h2>Pending Applications</h2>

    <table>
        <tr>
            <th>Name</th>
            <th>Year</th>
            <th>Department</th>
            <th>Approve</th>
            <th>Reject</th>
        </tr>

        {% for app in applied_apps %}
        <tr>
            <td>{{ app.volunteer.full_name }}</td>
            <td>{{ app.volunteer.year }}</td>
            <td>{{ app.volunteer.department }}</td>

            <td>
                <form method="post" action="{% url 'org_approve_volunteer' app.id %}">
                    {% csrf_token %}
                    <button>Approve</button>
                </form>
            </td>

            <td>
                <form method="post" action="{% url 'org_reject_volunteer' app.id %}">
                    {% csrf_token %}
                    <button>Reject</button>
                </form>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5">No pending applicants</td>
        </tr>
        {% endfor %}
    </table>

</div>

<!-- ================= REJECTED TABLE ================= -->

<div id="rejected_table" class="hidden">

    <h2>Rejected Volunteers</h2>

    <table>
        <tr>
            <th>Name</th>
            <th>Year</th>
            <th>Department</th>
        </tr>

        {% for app in rejected_apps %}
        <tr>
            <td>{{ app.volunteer.full_name }}</td>
            <td>{{ app.volunteer.year }}</td>
            <td>{{ app.volunteer.department }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3">No rejected volunteers</td>
        </tr>
        {% endfor %}
    </table>

</div>

<!-- ================= SIMPLE JS SWITCH ================= -->

<script>
    function showTable(type){
        document.getElementById("selected_table").classList.add("hidden");
        document.getElementById("applied_table").classList.add("hidden");
        document.getElementById("rejected_table").classList.add("hidden");

        document.getElementById(type + "_table").classList.remove("hidden");
    }
</script>

{% endblock %}
